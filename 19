import streamlit as st
import openai


def get_openai_api_key():
    if "api_key" not in st.session_state:
        st.session_state.api_key = ""

    api_key = st.text_input(
        label="OpenAI API Key 입력",
        value=st.session_state.api_key,
        type="password"
    )

    if api_key:
        st.session_state.api_key = api_key

    return api_key

def get_gpt_response(api_key, prompt):
    openai.api_key = api_key
    try:
        response = openai.Completion.create(
            model="gpt-4.1-mini"
            prompt=prompt,
            max_tokens=150
        )
        return response.choices[0].text.strip()
    except Exception as e:
        return f"Error: {str(e)}"

st.title("GPT-4.1-mini 모델 응답 웹앱")

api_key = get_openai_api_key()

if api_key:
    prompt = st.text_area("질문을 입력하세요.", placeholder="질문을 입력하세요...")
    
    if prompt:
        @st.cache_data
        def get_cached_response(api_key, prompt):
            return get_gpt_response(api_key, prompt)
        
        response = get_cached_response(api_key, prompt)
        
        st.subheader("GPT-4.1-mini 모델의 응답:")
        st.write(response)
else:
    st.warning("API Key를 입력해 주세요.")
