import streamlit as st
import openai

# API í‚¤ ì…ë ¥
api_key = st.sidebar.text_input("ğŸ”‘ OpenAI API Key", type="password")

# API í‚¤ ì—†ìœ¼ë©´ ì¢…ë£Œ
if not api_key:
    st.warning("API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”")
    st.stop()

openai.api_key = api_key

# âœ… ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”ëŠ” í•œ ë²ˆë§Œ!
if "messages" not in st.session_state:
    st.session_state.messages = [
        {"role": "system", "content": "ë‹¹ì‹ ì€ ì¹œì ˆí•œ AI ë¹„ì„œì…ë‹ˆë‹¤."}
    ]

# âœ… ì´ì „ ë©”ì‹œì§€ ì¶œë ¥
for msg in st.session_state.messages[1:]:
    with st.chat_message(msg["role"]):
        st.markdown(msg["content"])

# âœ… ì‚¬ìš©ì ì…ë ¥ ë°›ê¸°
if prompt := st.chat_input("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"):
    # ì‚¬ìš©ì ì…ë ¥ ì €ì¥
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)

    # âœ… ì „ì²´ ëŒ€í™” context ì „ë‹¬
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=st.session_state.messages
    )
    assistant_reply = response.choices[0].message["content"]

    # GPT ì‘ë‹µ ì €ì¥
    st.session_state.messages.append({"role": "assistant", "content": assistant_reply})
    with st.chat_message("assistant"):
        st.markdown(assistant_reply)

# âœ… ëŒ€í™” ì´ˆê¸°í™” ë²„íŠ¼
if st.sidebar.button("ğŸ§¹ ì´ˆê¸°í™”"):
    st.session_state.messages = [
        {"role": "system", "content": "ë‹¹ì‹ ì€ ì¹œì ˆí•œ AI ë¹„ì„œì…ë‹ˆë‹¤."}
    ]
    st.rerun()
